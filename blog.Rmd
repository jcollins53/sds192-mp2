---
title: "Mini-Project 2"
author: "Your Name Here"
date: "March 24, 2017"
output: html_document
---


## Loading the data


```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")

library(tidyverse)
```


```{r}
votesPerRegion <- house_elections %>%
  group_by(state, district) %>%
  summarise(general_votes = sum(general_votes) , primary_votes = sum(primary_votes) ) %>%
  gather(key = electionType, value = totalVotes, general_votes, primary_votes)

netContributionsByCandidate <- contributions %>%
  filter( transaction_type == "24E" | transaction_type == "24A") %>%
  mutate(transaction_type = ifelse(transaction_type == "24A", "against", "pro"))%>%
  rename(fec_id = cand_id) %>%
  group_by(fec_id, transaction_type) %>%
  summarise(sumContributions = sum(transaction_amt)) %>%
  spread(transaction_type, sumContributions, fill = 0) %>%
  mutate(netContribution = pro - against)
  
contributionsByRegionByCandidate <- house_elections %>%
  gather(key = electionType, value = votes, general_votes, primary_votes)%>%
  left_join(votesPerRegion, by = c("state", "district", "electionType"))%>%
  left_join(netContributionsByCandidate, by="fec_id") %>%
  mutate(percentVotes = votes/totalVotes, incumbent = factor(incumbent), ge_winner = factor(ge_winner), netContribution = ifelse(!is.na(netContribution), netContribution, 0))

electionPlot <- ggplot(contributionsByRegionByCandidate, aes(x = netContribution, y = percentVotes, col=incumbent, fill = incumbent)) +
  facet_wrap(~electionType)

electionPlot + geom_point( alpha =.5, na.rm = TRUE) 

electionPlot + geom_smooth( alpha =.5, na.rm = TRUE) 

```


```{r}
meanContribution <- function(filterExp = TRUE) {
  contributionsByRegionByCandidate %>%
    filter(eval(parse(text = filterExp), envir = contributionsByRegionByCandidate)) %>%
    summarise(meanCont = mean(netContribution))
  
}

meanContribution("incumbent == TRUE")

```

```{r}
meanContribution("incumbent == FALSE")
```

```{r}
meanContribution("ge_winner == 'W'")
```

```{r}
meanContribution("ge_winner == 'N'")
```

